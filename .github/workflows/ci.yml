# name: Wait for Deployment
# on: [push]

# jobs:
#   test:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: SFDigitalServices/wait-for-deployment-action@v1
#         id: deployment
#         with:
#           github-token: ${{ secrets.WEBSITE_TESTS_ACCESS_TOKEN }}
#           environment: Preview
#       - name: Deployed info
#         run: |
#           echo "Deployed to: ${{ steps.deployment.outputs.url }}"
name: ci
# https://docs.github.com/en/actions/reference/events-that-trigger-workflows
on: 
  deployment_status:
    state:
      - success
jobs:
  e2e:
    # only runs this job on successful deploy
    if: github.event_name == 'deployment_status' && github.event.deployment_status.state == 'success'
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: |
          echo "$GITHUB_CONTEXT"
      - uses: convictional/trigger-workflow-and-wait@v1.3.0
        with:
          owner: sergeibakaev
          repo: website-tests
          github_token: ${{ secrets.WEBSITE_TESTS_ACCESS_TOKEN }}
          inputs: '{ url: ${{ github.event.deployment_status.target_url }} }'
          workflow_file_name: e2e.yml
      # # https://github.com/marketplace/actions/github-status-action
      # - name: set pending status
      #   uses: Sibz/github-status-action@v1
      #   with:
      #     authToken: ${{ secrets.WEBSITE_TESTS_ACCESS_TOKEN }}
      #     context: 'E2E tests'
      #     description: 'Tests pending deploy'
      #     repository: 'website-tests'
      #     # success, error, failure, or pending
      #     state: 'pending'
      #     # sha: ${{github.event.pull_request.head.sha}}